<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Bebek Manyun vs Zombi</title>
  <style>
    :root{--bg:#98d6ff;--ground:#6b8f2f;--ui:#0f172a}
    html,body{height:100%;margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,Arial}
    body{display:flex;align-items:center;justify-content:center;background:linear-gradient(180deg,var(--bg),#bfe9ff);}
    #gameWrap{width:100%;max-width:900px;height:600px;box-shadow:0 10px 30px rgba(0,0,0,0.25);border-radius:12px;overflow:hidden;background:white;position:relative}
    canvas{display:block;background:linear-gradient(#cfefff, #eaf9ff);}
    .hud{position:absolute;left:12px;top:12px;color:var(--ui);font-weight:700;}
    .hud .score{font-size:20px}
    .hud .hp{margin-top:6px;font-size:14px}
    .controls{position:absolute;right:12px;top:12px;text-align:right}
    .controls small{display:block;color:#334155}
    .centerOverlay{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;flex-direction:column;gap:10px;background:rgba(15,23,42,0.02)}
    .btn{background:#0f172a;color:white;padding:10px 18px;border-radius:10px;border:none;font-weight:700;cursor:pointer}
    .touch-controls{position:absolute;left:12px;bottom:12px;display:flex;gap:8px}
    .touch-button{width:64px;height:64px;border-radius:12px;background:rgba(0,0,0,0.12);display:flex;align-items:center;justify-content:center;font-weight:800;color:#062b3a}
  </style>
</head>
<body>
  <div id="gameWrap">
    <canvas id="gameCanvas" width="900" height="600"></canvas>
    <div class="hud">
      <div class="score">Skor: <span id="score">0</span></div>
      <div class="hp">HP: <span id="hp">100</span></div>
    </div>
    <div class="controls">
      <small>Kontrol: ← → / A D — Lompat: ↑ / W — Serang: Space</small>
    </div>
    <div id="overlayStart" class="centerOverlay">
      <h1 style="margin:0">Bebek Manyun vs Zombi</h1>
      <p style="margin:0">Lawan gerombolan zombi. Jaga HP dan kumpulkan skor!</p>
      <button id="startBtn" class="btn">Mainkan</button>
      <small style="color:#334155">Cocok untuk desktop dan HP</small>
    </div>

    <div class="touch-controls" id="touchControls" style="display:none">
      <div class="touch-button" id="leftBtn">◀</div>
      <div class="touch-button" id="jumpBtn">▲</div>
      <div class="touch-button" id="rightBtn">▶</div>
      <div class="touch-button" id="attackBtn">QUAK</div>
    </div>
  </div>

<script>
// ======= Full 2D canvas game: Bebek Manyun vs Zombi ======
// Single-file, no external assets.

const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
let W = canvas.width, H = canvas.height;

const overlay = document.getElementById('overlayStart');
const startBtn = document.getElementById('startBtn');
const scoreEl = document.getElementById('score');
const hpEl = document.getElementById('hp');
const touchControls = document.getElementById('touchControls');

let running = false;
let score = 0;
let spawnTimer = 0;
let spawnInterval = 120; // frames
let entities = [];
let keys = {};

const player = {
  x: 120, y: 0, w: 60, h: 48,
  vx: 0, vy: 0, speed: 3.6,
  onGround: false,
  hp: 100,
  attackCooldown: 0
};

const GRAV = 0.6;
const FRICTION = 0.92;
const GROUND_Y = H - 80;

function rand(min, max){return Math.random()*(max-min)+min}

function spawnZombie(){
  const z = {
    type: 'zombie',
    x: W + 60,
    y: GROUND_Y - 48,
    w: 52, h: 64,
    vx: rand(-1.4, -0.9) - Math.min(0.6, score/500),
    hp: 20 + Math.floor(score/50),
    speedBase: 1.2
  };
  entities.push(z);
}

function spawnBat(){
  const b = {
    type: 'bat', x: W + 60, y: rand(120, GROUND_Y-200), w:40, h:30,
    vx: rand(-2.2, -1.2), hp: 10
  };
  entities.push(b);
}

function shoot(){
  if(player.attackCooldown>0) return;
  player.attackCooldown = 18; // cooldown frames
  const p = {type:'quack', x:player.x+player.w, y:player.y+18, vx:6, w:18, h:10, dmg:12};
  entities.push(p);
}

function update(){
  if(!running) return;
  // player input
  if(keys['ArrowLeft']||keys['a']) player.vx = Math.max(player.vx-0.6, -player.speed);
  if(keys['ArrowRight']||keys['d']) player.vx = Math.min(player.vx+0.6, player.speed);
  if(!(keys['ArrowLeft']||keys['a']||keys['ArrowRight']||keys['d'])) player.vx *= FRICTION;
  if((keys['ArrowUp']||keys['w']) && player.onGround){ player.vy = -12; player.onGround=false; }
  if(keys[' ']||keys['Space']) shoot();

  // physics
  player.vy += GRAV; player.x += player.vx; player.y += player.vy;
  if(player.y + player.h >= GROUND_Y){ player.y = GROUND_Y - player.h; player.vy = 0; player.onGround = true; }
  if(player.x < 10) player.x = 10; if(player.x + player.w > W-10) player.x = W-10-player.w;
  if(player.attackCooldown>0) player.attackCooldown--;

  // spawn
  spawnTimer++;
  if(spawnTimer > spawnInterval){
    spawnTimer = 0;
    if(Math.random() < Math.min(0.6, 0.2 + score/300)) spawnZombie();
    if(Math.random() < 0.2 + Math.min(0.5, score/800)) spawnBat();
    spawnInterval = Math.max(40, 120 - Math.floor(score/10));
  }

  // update entities
  for(let i=entities.length-1;i>=0;i--){
    const e = entities[i];
    if(e.type === 'zombie' || e.type==='bat'){
      e.x += e.vx;
      // simple attack if close to player
      if(e.x < player.x + player.w && e.x + e.w > player.x && e.y + e.h > player.y + 10){
        // collision
        player.hp -= 0.18; // continuous damage
      }
      if(e.x + e.w < -40) entities.splice(i,1);
    }
    if(e.type === 'quack'){
      e.x += e.vx;
      // collision with enemies
      for(let j=entities.length-1;j>=0;j--){
        const t = entities[j]; if(t===e) continue; if(t.type==='zombie' || t.type==='bat'){
          if(e.x < t.x + t.w && e.x + e.w > t.x && e.y < t.y + t.h && e.y + e.h > t.y){
            t.hp -= e.dmg; // hit
            // tiny knockback
            t.x += 8;
            // remove projectile
            const idx = entities.indexOf(e); if(idx>=0) entities.splice(idx,1);
            break;
          }
        }
      }
      if(e.x > W + 40) { const idx = entities.indexOf(e); if(idx>=0) entities.splice(idx,1); }
    }

    // enemy death
    if((e.type==='zombie' || e.type==='bat') && e.hp <= 0){
      score += (e.type==='zombie') ? 25 : 12;
      // spawn small particles / coins (visual)
      entities.splice(i,1);
    }
  }

  // lose condition
  if(player.hp <= 0){ endGame(); }

  // update UI
  scoreEl.textContent = Math.floor(score);
  hpEl.textContent = Math.max(0, Math.floor(player.hp));
}

function draw(){
  // background
  ctx.clearRect(0,0,W,H);

  // sky gradient
  const g = ctx.createLinearGradient(0,0,0,H);
  g.addColorStop(0,'#cfefff'); g.addColorStop(1,'#eaf9ff');
  ctx.fillStyle = g; ctx.fillRect(0,0,W,H);

  // clouds (simple)
  for(let i=0;i<4;i++){
    ctx.globalAlpha = 0.2; ctx.beginPath(); ctx.ellipse(100 + i*220 + (Date.now()%5000)/50,80,80,30,0,0,Math.PI*2); ctx.fillStyle='#ffffff'; ctx.fill(); ctx.globalAlpha = 1;
  }

  // ground
  ctx.fillStyle = '#6b8f2f'; ctx.fillRect(0, GROUND_Y, W, H - GROUND_Y);
  ctx.fillStyle = '#4b6b1f'; for(let i=0;i<30;i++){ ctx.fillRect(i*60, GROUND_Y, 30, 6); }

  // player draw: bebek manyun (simple)
  drawDuck(player.x, player.y, player.w, player.h);

  // entities
  for(const e of entities){
    if(e.type === 'zombie') drawZombie(e.x, e.y, e.w, e.h);
    if(e.type === 'bat') drawBat(e.x, e.y, e.w, e.h);
    if(e.type === 'quack') drawQuack(e.x, e.y, e.w, e.h);
  }
}

function drawDuck(x,y,w,h){
  // body
  ctx.fillStyle = '#ffd54a'; ctx.beginPath(); ctx.ellipse(x + w*0.45, y + h*0.5, w*0.5, h*0.55, 0, 0, Math.PI*2); ctx.fill();
  // beak
  ctx.fillStyle = '#ff8a00'; ctx.beginPath(); ctx.moveTo(x+w, y+h*0.45); ctx.lineTo(x+w+16, y+h*0.5); ctx.lineTo(x+w, y+h*0.6); ctx.fill();
  // eye
  ctx.fillStyle = '#062b3a'; ctx.beginPath(); ctx.arc(x + w*0.3, y + h*0.35, 6,0,Math.PI*2); ctx.fill();
  // sad mouth (manyun)
  ctx.strokeStyle = '#5b3a00'; ctx.lineWidth=2; ctx.beginPath(); ctx.moveTo(x + w*0.25, y + h*0.68); ctx.quadraticCurveTo(x + w*0.45, y + h*0.78, x + w*0.65, y + h*0.68); ctx.stroke();
}

function drawZombie(x,y,w,h){
  ctx.fillStyle = '#7bbf6f'; ctx.fillRect(x, y, w, h); // body
  // head
  ctx.fillStyle = '#6aa56a'; ctx.fillRect(x-6, y-24, w+12, 26);
  // eyes
  ctx.fillStyle = '#ffffff'; ctx.fillRect(x+8,y-16,8,8); ctx.fillRect(x+w-20,y-16,8,8);
  ctx.fillStyle='#062b3a'; ctx.fillRect(x+10,y-14,4,4); ctx.fillRect(x+w-18,y-14,4,4);
}

function drawBat(x,y,w,h){
  ctx.fillStyle = '#3b3b3b'; ctx.beginPath(); ctx.ellipse(x + w*0.5, y + h*0.5, w*0.8, h*0.8, 0, 0, Math.PI*2); ctx.fill();
}

function drawQuack(x,y,w,h){
  ctx.fillStyle = '#8be0ff'; ctx.fillRect(x,y,w,h); ctx.fillStyle='#062b3a'; ctx.fillText('QU', x+2, y+8);
}

function loop(){ update(); draw(); if(running) requestAnimationFrame(loop); }

function startGame(){
  // reset
  running = true; score = 0; entities = []; player.hp = 100; player.x = 120; player.y = GROUND_Y - player.h; player.vx=0; player.vy=0; spawnTimer=0; spawnInterval=120;
  overlay.style.display = 'none'; touchControls.style.display = /Mobi|Android/i.test(navigator.userAgent) ? 'flex' : 'none';
  requestAnimationFrame(loop);
}

function endGame(){
  running = false; overlay.style.display = 'flex';
  overlay.querySelector('h1').textContent = 'Game Over';
  overlay.querySelector('p').textContent = `Skor akhir: ${Math.floor(score)} — tekan Mainkan untuk coba lagi`;
}

// input handlers
window.addEventListener('keydown', e=>{ keys[e.key] = true; });
window.addEventListener('keyup', e=>{ keys[e.key] = false; });

startBtn.addEventListener('click', ()=>{ startGame(); });

// mobile touch
const leftBtn = document.getElementById('leftBtn');
const rightBtn = document.getElementById('rightBtn');
const jumpBtn = document.getElementById('jumpBtn');
const attackBtn = document.getElementById('attackBtn');

function addTouch(btn, key){
  btn.addEventListener('touchstart', e=>{ e.preventDefault(); keys[key]=true; });
  btn.addEventListener('touchend', e=>{ e.preventDefault(); keys[key]=false; });
}
addTouch(leftBtn,'a'); addTouch(rightBtn,'d'); addTouch(jumpBtn,'w');
attackBtn.addEventListener('touchstart', e=>{ e.preventDefault(); shoot(); });

// responsive canvas
function resizeCanvas(){
  const wrap = document.getElementById('gameWrap');
  const rect = wrap.getBoundingClientRect();
  const scale = Math.min(rect.width / 900, 1);
  canvas.style.transform = `scale(${scale})`; canvas.style.transformOrigin = 'left top';
}
window.addEventListener('resize', resizeCanvas); resizeCanvas();

// small auto spawn for demo when idle
setInterval(()=>{ if(!running && Math.random()<0.08) spawnZombie(); }, 1200);

</script>
</body>
</html>
